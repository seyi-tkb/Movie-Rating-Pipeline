2025-09-30 07:38:51,946 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 07:38:51,980 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 07:38:52,013 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 07:38:52,013 - __main__ - INFO - Creating tables if not exist..
2025-09-30 07:38:52,014 - pipeline.s_gold.load - ERROR - Pipeline failed: too many values to unpack (expected 2)
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 25, in check_tables
    for table_name, sql_str in table_dict:
ValueError: too many values to unpack (expected 2)
2025-09-30 07:38:52,015 - __main__ - INFO - Processing users data..
2025-09-30 07:38:52,015 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 07:38:52,940 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 07:38:52,940 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 07:38:53,287 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 07:45:38,067 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 07:45:38,132 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 07:45:38,157 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 07:45:38,159 - __main__ - INFO - Creating tables if not exist..
2025-09-30 07:45:38,159 - pipeline.s_gold.load - ERROR - Pipeline failed: too many values to unpack (expected 2)
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 25, in check_tables
    for table_name, sql_str in table_dict:
ValueError: too many values to unpack (expected 2)
2025-09-30 07:45:38,159 - __main__ - INFO - Processing users data..
2025-09-30 07:45:38,159 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 07:45:39,197 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 07:45:39,198 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 07:45:39,256 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 08:04:02,191 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:04:02,245 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:04:02,248 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 08:04:02,249 - __main__ - INFO - Creating tables if not exist..
2025-09-30 08:04:02,461 - pipeline.s_gold.load - ERROR - Pipeline failed: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: FATAL:  database "movies_db" does not exist

(Background on this error at: https://sqlalche.me/e/14/e3q8)
Traceback (most recent call last):
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3371, in _wrap_pool_connect
    return fn()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 327, in connect
    return _ConnectionFairy._checkout(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 894, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 493, in checkout
    rec = pool._do_get()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\impl.py", line 146, in _do_get
    self._dec_overflow()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\langhelpers.py", line 70, in __exit__
    compat.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\impl.py", line 143, in _do_get
    return self._create_connection()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 273, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 388, in __init__
    self.__connect()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 691, in __connect
    pool.logger.debug("Error on connect(): %s", e)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\langhelpers.py", line 70, in __exit__
    compat.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 686, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\create.py", line 574, in connect
    return dialect.connect(*cargs, **cparams)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 598, in connect
    return self.dbapi.connect(*cargs, **cparams)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\psycopg2\__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: FATAL:  database "movies_db" does not exist


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 26, in check_tables
    create_table_if_not_exists(sql_str, table_name)
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 28, in create_table_if_not_exists
    with engine.begin() as conn: # begin ensures commit. connect has to be closed to commit
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3153, in begin
    conn = self.connect(close_with_result=close_with_result)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3325, in connect
    return self._connection_cls(self, close_with_result=close_with_result)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 96, in __init__
    else engine.raw_connection()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3404, in raw_connection
    return self._wrap_pool_connect(self.pool.connect, _connection)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3374, in _wrap_pool_connect
    Connection._handle_dbapi_exception_noconnection(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 2208, in _handle_dbapi_exception_noconnection
    util.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3371, in _wrap_pool_connect
    return fn()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 327, in connect
    return _ConnectionFairy._checkout(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 894, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 493, in checkout
    rec = pool._do_get()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\impl.py", line 146, in _do_get
    self._dec_overflow()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\langhelpers.py", line 70, in __exit__
    compat.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\impl.py", line 143, in _do_get
    return self._create_connection()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 273, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 388, in __init__
    self.__connect()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 691, in __connect
    pool.logger.debug("Error on connect(): %s", e)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\langhelpers.py", line 70, in __exit__
    compat.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 686, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\create.py", line 574, in connect
    return dialect.connect(*cargs, **cparams)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 598, in connect
    return self.dbapi.connect(*cargs, **cparams)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\psycopg2\__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: FATAL:  database "movies_db" does not exist

(Background on this error at: https://sqlalche.me/e/14/e3q8)
2025-09-30 08:04:02,577 - __main__ - INFO - Processing users data..
2025-09-30 08:04:02,577 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 08:04:03,394 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 08:04:03,394 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 08:04:03,416 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 08:10:29,740 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:10:29,763 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:10:29,765 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 08:10:29,766 - __main__ - INFO - Creating tables if not exist..
2025-09-30 08:10:29,845 - pipeline.s_gold.load - ERROR - Pipeline failed: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: FATAL:  database "movies_rating_database" does not exist

(Background on this error at: https://sqlalche.me/e/14/e3q8)
Traceback (most recent call last):
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3371, in _wrap_pool_connect
    return fn()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 327, in connect
    return _ConnectionFairy._checkout(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 894, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 493, in checkout
    rec = pool._do_get()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\impl.py", line 146, in _do_get
    self._dec_overflow()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\langhelpers.py", line 70, in __exit__
    compat.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\impl.py", line 143, in _do_get
    return self._create_connection()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 273, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 388, in __init__
    self.__connect()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 691, in __connect
    pool.logger.debug("Error on connect(): %s", e)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\langhelpers.py", line 70, in __exit__
    compat.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 686, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\create.py", line 574, in connect
    return dialect.connect(*cargs, **cparams)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 598, in connect
    return self.dbapi.connect(*cargs, **cparams)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\psycopg2\__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: FATAL:  database "movies_rating_database" does not exist


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 26, in check_tables
    create_table_if_not_exists(sql_str, table_name)
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 28, in create_table_if_not_exists
    with engine.begin() as conn: # begin ensures commit. connect has to be closed to commit
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3153, in begin
    conn = self.connect(close_with_result=close_with_result)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3325, in connect
    return self._connection_cls(self, close_with_result=close_with_result)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 96, in __init__
    else engine.raw_connection()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3404, in raw_connection
    return self._wrap_pool_connect(self.pool.connect, _connection)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3374, in _wrap_pool_connect
    Connection._handle_dbapi_exception_noconnection(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 2208, in _handle_dbapi_exception_noconnection
    util.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3371, in _wrap_pool_connect
    return fn()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 327, in connect
    return _ConnectionFairy._checkout(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 894, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 493, in checkout
    rec = pool._do_get()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\impl.py", line 146, in _do_get
    self._dec_overflow()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\langhelpers.py", line 70, in __exit__
    compat.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\impl.py", line 143, in _do_get
    return self._create_connection()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 273, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 388, in __init__
    self.__connect()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 691, in __connect
    pool.logger.debug("Error on connect(): %s", e)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\langhelpers.py", line 70, in __exit__
    compat.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 686, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\create.py", line 574, in connect
    return dialect.connect(*cargs, **cparams)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 598, in connect
    return self.dbapi.connect(*cargs, **cparams)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\psycopg2\__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: FATAL:  database "movies_rating_database" does not exist

(Background on this error at: https://sqlalche.me/e/14/e3q8)
2025-09-30 08:10:29,852 - __main__ - INFO - Processing users data..
2025-09-30 08:10:29,853 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 08:10:30,936 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 08:10:30,937 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 08:10:30,956 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 08:23:35,364 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:23:35,370 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:23:35,377 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 08:23:35,377 - __main__ - INFO - Creating tables if not exist..
2025-09-30 08:23:35,475 - pipeline.s_gold.load - ERROR - Pipeline failed: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: FATAL:  database "movies_rating_database" does not exist

(Background on this error at: https://sqlalche.me/e/14/e3q8)
Traceback (most recent call last):
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3371, in _wrap_pool_connect
    return fn()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 327, in connect
    return _ConnectionFairy._checkout(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 894, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 493, in checkout
    rec = pool._do_get()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\impl.py", line 146, in _do_get
    self._dec_overflow()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\langhelpers.py", line 70, in __exit__
    compat.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\impl.py", line 143, in _do_get
    return self._create_connection()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 273, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 388, in __init__
    self.__connect()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 691, in __connect
    pool.logger.debug("Error on connect(): %s", e)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\langhelpers.py", line 70, in __exit__
    compat.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 686, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\create.py", line 574, in connect
    return dialect.connect(*cargs, **cparams)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 598, in connect
    return self.dbapi.connect(*cargs, **cparams)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\psycopg2\__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
psycopg2.OperationalError: connection to server at "localhost" (::1), port 5432 failed: FATAL:  database "movies_rating_database" does not exist


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 26, in check_tables
    create_table_if_not_exists(sql_str, table_name)
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 28, in create_table_if_not_exists
    with engine.begin() as conn: # begin ensures commit. connect has to be closed to commit
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3153, in begin
    conn = self.connect(close_with_result=close_with_result)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3325, in connect
    return self._connection_cls(self, close_with_result=close_with_result)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 96, in __init__
    else engine.raw_connection()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3404, in raw_connection
    return self._wrap_pool_connect(self.pool.connect, _connection)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3374, in _wrap_pool_connect
    Connection._handle_dbapi_exception_noconnection(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 2208, in _handle_dbapi_exception_noconnection
    util.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 3371, in _wrap_pool_connect
    return fn()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 327, in connect
    return _ConnectionFairy._checkout(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 894, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 493, in checkout
    rec = pool._do_get()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\impl.py", line 146, in _do_get
    self._dec_overflow()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\langhelpers.py", line 70, in __exit__
    compat.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\impl.py", line 143, in _do_get
    return self._create_connection()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 273, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 388, in __init__
    self.__connect()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 691, in __connect
    pool.logger.debug("Error on connect(): %s", e)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\langhelpers.py", line 70, in __exit__
    compat.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\pool\base.py", line 686, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\create.py", line 574, in connect
    return dialect.connect(*cargs, **cparams)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 598, in connect
    return self.dbapi.connect(*cargs, **cparams)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\psycopg2\__init__.py", line 122, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "localhost" (::1), port 5432 failed: FATAL:  database "movies_rating_database" does not exist

(Background on this error at: https://sqlalche.me/e/14/e3q8)
2025-09-30 08:23:35,490 - __main__ - INFO - Processing users data..
2025-09-30 08:23:35,491 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 08:23:36,401 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 08:23:36,401 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 08:23:36,421 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 08:25:29,941 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:25:29,953 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:25:29,956 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 08:25:29,957 - __main__ - INFO - Creating tables if not exist..
2025-09-30 08:25:30,343 - pipeline.s_gold.load - ERROR - Pipeline failed: (psycopg2.errors.SyntaxError) syntax error at or near "valid_from"
LINE 8:     valid_from TIMESTAMP NOT NULL,
            ^

[SQL: 
CREATE TABLE IF NOT EXISTS users (
    user_id INT NOT NULL,
    gender CHAR(1),
    age INT,
    occupation TEXT,
    zip_code TEXT
    valid_from TIMESTAMP NOT NULL,
    valid_to TIMESTAMP,
    is_current BOOLEAN NOT NULL DEFAULT TRUE,
    PRIMARY KEY (user_id, valid_from)
);
]
(Background on this error at: https://sqlalche.me/e/14/f405)
Traceback (most recent call last):
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1910, in _execute_context
    self.dialect.do_execute(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.SyntaxError: syntax error at or near "valid_from"
LINE 8:     valid_from TIMESTAMP NOT NULL,
            ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 26, in check_tables
    create_table_if_not_exists(sql_str, table_name)
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 29, in create_table_if_not_exists
    conn.execute(text(sql))
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\sql\elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1910, in _execute_context
    self.dialect.do_execute(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.SyntaxError) syntax error at or near "valid_from"
LINE 8:     valid_from TIMESTAMP NOT NULL,
            ^

[SQL: 
CREATE TABLE IF NOT EXISTS users (
    user_id INT NOT NULL,
    gender CHAR(1),
    age INT,
    occupation TEXT,
    zip_code TEXT
    valid_from TIMESTAMP NOT NULL,
    valid_to TIMESTAMP,
    is_current BOOLEAN NOT NULL DEFAULT TRUE,
    PRIMARY KEY (user_id, valid_from)
);
]
(Background on this error at: https://sqlalche.me/e/14/f405)
2025-09-30 08:25:30,389 - __main__ - INFO - Processing users data..
2025-09-30 08:25:30,389 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 08:25:31,190 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 08:25:31,191 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 08:25:31,208 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 08:26:50,086 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:26:50,092 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:26:50,126 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 08:26:50,127 - __main__ - INFO - Creating tables if not exist..
2025-09-30 08:26:50,618 - pipeline.s_gold.load - ERROR - Pipeline failed: (psycopg2.errors.InvalidForeignKey) there is no unique constraint matching given keys for referenced table "users"

[SQL: 
CREATE TABLE IF NOT EXISTS ratings (
    user_id INT REFERENCES users(user_id),
    item_id INT REFERENCES movies(item_id),
    rating DOUBLE PRECISION,
    timestamp TIMESTAMP,
    PRIMARY KEY (user_id, item_id, timestamp)
);
]
(Background on this error at: https://sqlalche.me/e/14/f405)
Traceback (most recent call last):
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1910, in _execute_context
    self.dialect.do_execute(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InvalidForeignKey: there is no unique constraint matching given keys for referenced table "users"


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 26, in check_tables
    create_table_if_not_exists(sql_str, table_name)
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 29, in create_table_if_not_exists
    conn.execute(text(sql))
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1385, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\sql\elements.py", line 334, in _execute_on_connection
    return connection._execute_clauseelement(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1577, in _execute_clauseelement
    ret = self._execute_context(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1953, in _execute_context
    self._handle_dbapi_exception(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 2134, in _handle_dbapi_exception
    util.raise_(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\util\compat.py", line 211, in raise_
    raise exception
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1910, in _execute_context
    self.dialect.do_execute(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 736, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.InvalidForeignKey) there is no unique constraint matching given keys for referenced table "users"

[SQL: 
CREATE TABLE IF NOT EXISTS ratings (
    user_id INT REFERENCES users(user_id),
    item_id INT REFERENCES movies(item_id),
    rating DOUBLE PRECISION,
    timestamp TIMESTAMP,
    PRIMARY KEY (user_id, item_id, timestamp)
);
]
(Background on this error at: https://sqlalche.me/e/14/f405)
2025-09-30 08:26:50,622 - __main__ - INFO - Processing users data..
2025-09-30 08:26:50,622 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 08:26:51,448 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 08:26:51,449 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 08:26:51,456 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 08:29:01,733 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:29:01,739 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:29:01,786 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 08:29:01,787 - __main__ - INFO - Creating tables if not exist..
2025-09-30 08:29:02,211 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 08:29:02,213 - __main__ - INFO - Processing users data..
2025-09-30 08:29:02,213 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 08:29:02,982 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 08:29:02,983 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 08:29:02,993 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 08:52:19,657 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:52:19,697 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:52:19,715 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 08:52:19,716 - __main__ - INFO - Creating tables if not exist..
2025-09-30 08:52:20,159 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 08:52:20,159 - __main__ - INFO - Processing users data..
2025-09-30 08:52:20,159 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 08:52:21,125 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 08:52:21,126 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 08:52:21,220 - __main__ - ERROR - Pipeline failed: '_trans_ctx' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine.begin(), if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: '_trans_ctx' object has no attribute 'cursor'
2025-09-30 08:55:24,980 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:55:25,021 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:55:25,022 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 08:55:25,023 - __main__ - INFO - Creating tables if not exist..
2025-09-30 08:55:25,431 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 08:55:25,432 - __main__ - INFO - Processing users data..
2025-09-30 08:55:25,432 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 08:55:26,446 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 08:55:26,446 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 08:55:26,537 - __main__ - ERROR - Pipeline failed: 'Connection' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 47, in write_to_postgres
    df.to_sql(name= table_name, con=conn, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Connection' object has no attribute 'cursor'
2025-09-30 08:57:27,765 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:57:27,811 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 08:57:27,814 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 08:57:27,814 - __main__ - INFO - Creating tables if not exist..
2025-09-30 08:57:28,192 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 08:57:28,192 - __main__ - INFO - Processing users data..
2025-09-30 08:57:28,193 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 08:57:29,052 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 08:57:29,053 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 08:57:29,065 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 09:02:13,366 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:02:13,414 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:02:13,417 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 09:02:13,417 - __main__ - INFO - Creating tables if not exist..
2025-09-30 09:02:13,967 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 09:02:13,968 - __main__ - INFO - Processing users data..
2025-09-30 09:02:13,968 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 09:02:14,821 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 09:02:14,822 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 09:02:14,908 - __main__ - ERROR - Pipeline failed: 'Connection' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 47, in write_to_postgres
    df.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Connection' object has no attribute 'cursor'
2025-09-30 09:18:08,355 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:18:08,403 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:18:08,405 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 09:18:08,405 - __main__ - INFO - Creating tables if not exist..
2025-09-30 09:18:08,784 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 09:18:08,784 - __main__ - INFO - Processing users data..
2025-09-30 09:18:08,785 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 09:18:09,594 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 09:18:09,594 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 09:18:09,607 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 09:24:30,338 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:24:30,378 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:24:30,378 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 09:24:30,378 - __main__ - INFO - Creating tables if not exist..
2025-09-30 09:24:30,870 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 09:24:30,870 - __main__ - INFO - Processing users data..
2025-09-30 09:24:30,870 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 09:24:31,722 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 09:24:31,738 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 09:24:31,832 - __main__ - ERROR - Pipeline failed: 'Connection' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 47, in write_to_postgres
    df.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Connection' object has no attribute 'cursor'
2025-09-30 09:25:04,766 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:25:04,819 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:25:04,821 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 09:25:04,821 - __main__ - INFO - Creating tables if not exist..
2025-09-30 09:25:05,286 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 09:25:05,286 - __main__ - INFO - Processing users data..
2025-09-30 09:25:05,287 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 09:25:06,209 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 09:25:06,209 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 09:25:06,238 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 09:29:54,202 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:29:54,245 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:29:54,245 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 09:29:54,245 - __main__ - INFO - Creating tables if not exist..
2025-09-30 09:29:54,865 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 09:29:54,866 - __main__ - INFO - Processing users data..
2025-09-30 09:29:54,866 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 09:29:55,608 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 09:29:55,608 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 09:29:55,640 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 09:35:56,679 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:35:56,726 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:35:56,726 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 09:35:56,726 - __main__ - INFO - Creating tables if not exist..
2025-09-30 09:35:57,148 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 09:35:57,148 - __main__ - INFO - Processing users data..
2025-09-30 09:35:57,148 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 09:35:58,368 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 09:35:58,368 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 09:35:58,398 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 46, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 09:40:36,313 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:40:36,357 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:40:36,358 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 09:40:36,358 - __main__ - INFO - Creating tables if not exist..
2025-09-30 09:40:36,904 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 09:40:36,904 - __main__ - INFO - Processing users data..
2025-09-30 09:40:36,904 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 09:40:39,035 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 09:40:39,036 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 09:40:39,062 - __main__ - ERROR - Pipeline failed: 'Engine' object has no attribute 'cursor'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 168, in load_users_df
    write_to_postgres(df, 'staging_users', "replace")
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\connection.py", line 47, in write_to_postgres
    df.to_sql(name= table_name, con=engine, if_exists=mode, index=False, method='multi')
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\util\_decorators.py", line 333, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 3081, in to_sql
    return sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 842, in to_sql
    return pandas_sql.to_sql(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2851, in to_sql
    table.create()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 984, in create
    if self.exists():
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 970, in exists
    return self.pd_sql.has_table(self.name, self.schema)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2866, in has_table
    return len(self.execute(query, [name]).fetchall()) > 0
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\io\sql.py", line 2673, in execute
    cur = self.con.cursor()
AttributeError: 'Engine' object has no attribute 'cursor'
2025-09-30 09:55:24,851 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:55:24,899 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 09:55:24,903 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 09:55:24,904 - __main__ - INFO - Creating tables if not exist..
2025-09-30 09:55:25,356 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 09:55:25,357 - __main__ - INFO - Processing users data..
2025-09-30 09:55:25,357 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 09:55:26,200 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 09:55:26,200 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 09:55:26,462 - pipeline.s_gold.load - ERROR - CDC upsert failed: (psycopg2.errors.UndefinedTable) relation "change_table" does not exist
LINE 28: JOIN change_table c ON s.user_id = c.user_id;
              ^

[SQL: 
-- inserts new users
INSERT INTO users (user_id, gender, age, occupation, zip_code, valid_from, valid_to, is_current)
SELECT s.user_id, s.gender, s.age::int, s.occupation, s.zip_code, now() AT TIME ZONE 'UTC', NULL, TRUE
FROM stg_users s
LEFT JOIN users u ON u.user_id = s.user_id AND u.is_current = TRUE
WHERE u.user_id IS NULL;

-- closes current records where any attribute changed
WITH change_table AS (
    SELECT u.user_id
    FROM users u
    JOIN stg_users s ON u.user_id = s.user_id
    WHERE u.is_current = TRUE AND (
        COALESCE(u.occupation, '') <> COALESCE(s.occupation, '') OR
        COALESCE(u.zip_code, '') <> COALESCE(s.zip_code, ''))
        -- coalesce so if either is null, it recognizes it properly as a change
)
UPDATE users
SET is_current = FALSE,
    valid_to = now() AT TIME ZONE 'UTC'
WHERE user_id IN (SELECT user_id FROM change_table) AND is_current = TRUE;

-- inserts new version of changed users
INSERT INTO users (user_id, gender, age, occupation, zip_code, valid_from, valid_to, is_current)
SELECT s.user_id, s.gender, s.age::int, s.occupation, s.zip_code, now() AT TIME ZONE 'UTC', NULL, TRUE
FROM stg_users s
JOIN change_table c ON s.user_id = c.user_id;
]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedTable: relation "change_table" does not exist
LINE 28: JOIN change_table c ON s.user_id = c.user_id;
              ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 174, in load_users_df
    conn.execute(text(upsert_users))
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "change_table" does not exist
LINE 28: JOIN change_table c ON s.user_id = c.user_id;
              ^

[SQL: 
-- inserts new users
INSERT INTO users (user_id, gender, age, occupation, zip_code, valid_from, valid_to, is_current)
SELECT s.user_id, s.gender, s.age::int, s.occupation, s.zip_code, now() AT TIME ZONE 'UTC', NULL, TRUE
FROM stg_users s
LEFT JOIN users u ON u.user_id = s.user_id AND u.is_current = TRUE
WHERE u.user_id IS NULL;

-- closes current records where any attribute changed
WITH change_table AS (
    SELECT u.user_id
    FROM users u
    JOIN stg_users s ON u.user_id = s.user_id
    WHERE u.is_current = TRUE AND (
        COALESCE(u.occupation, '') <> COALESCE(s.occupation, '') OR
        COALESCE(u.zip_code, '') <> COALESCE(s.zip_code, ''))
        -- coalesce so if either is null, it recognizes it properly as a change
)
UPDATE users
SET is_current = FALSE,
    valid_to = now() AT TIME ZONE 'UTC'
WHERE user_id IN (SELECT user_id FROM change_table) AND is_current = TRUE;

-- inserts new version of changed users
INSERT INTO users (user_id, gender, age, occupation, zip_code, valid_from, valid_to, is_current)
SELECT s.user_id, s.gender, s.age::int, s.occupation, s.zip_code, now() AT TIME ZONE 'UTC', NULL, TRUE
FROM stg_users s
JOIN change_table c ON s.user_id = c.user_id;
]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-30 09:55:26,478 - __main__ - ERROR - Pipeline failed: (psycopg2.errors.UndefinedTable) relation "change_table" does not exist
LINE 28: JOIN change_table c ON s.user_id = c.user_id;
              ^

[SQL: 
-- inserts new users
INSERT INTO users (user_id, gender, age, occupation, zip_code, valid_from, valid_to, is_current)
SELECT s.user_id, s.gender, s.age::int, s.occupation, s.zip_code, now() AT TIME ZONE 'UTC', NULL, TRUE
FROM stg_users s
LEFT JOIN users u ON u.user_id = s.user_id AND u.is_current = TRUE
WHERE u.user_id IS NULL;

-- closes current records where any attribute changed
WITH change_table AS (
    SELECT u.user_id
    FROM users u
    JOIN stg_users s ON u.user_id = s.user_id
    WHERE u.is_current = TRUE AND (
        COALESCE(u.occupation, '') <> COALESCE(s.occupation, '') OR
        COALESCE(u.zip_code, '') <> COALESCE(s.zip_code, ''))
        -- coalesce so if either is null, it recognizes it properly as a change
)
UPDATE users
SET is_current = FALSE,
    valid_to = now() AT TIME ZONE 'UTC'
WHERE user_id IN (SELECT user_id FROM change_table) AND is_current = TRUE;

-- inserts new version of changed users
INSERT INTO users (user_id, gender, age, occupation, zip_code, valid_from, valid_to, is_current)
SELECT s.user_id, s.gender, s.age::int, s.occupation, s.zip_code, now() AT TIME ZONE 'UTC', NULL, TRUE
FROM stg_users s
JOIN change_table c ON s.user_id = c.user_id;
]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedTable: relation "change_table" does not exist
LINE 28: JOIN change_table c ON s.user_id = c.user_id;
              ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 174, in load_users_df
    conn.execute(text(upsert_users))
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "change_table" does not exist
LINE 28: JOIN change_table c ON s.user_id = c.user_id;
              ^

[SQL: 
-- inserts new users
INSERT INTO users (user_id, gender, age, occupation, zip_code, valid_from, valid_to, is_current)
SELECT s.user_id, s.gender, s.age::int, s.occupation, s.zip_code, now() AT TIME ZONE 'UTC', NULL, TRUE
FROM stg_users s
LEFT JOIN users u ON u.user_id = s.user_id AND u.is_current = TRUE
WHERE u.user_id IS NULL;

-- closes current records where any attribute changed
WITH change_table AS (
    SELECT u.user_id
    FROM users u
    JOIN stg_users s ON u.user_id = s.user_id
    WHERE u.is_current = TRUE AND (
        COALESCE(u.occupation, '') <> COALESCE(s.occupation, '') OR
        COALESCE(u.zip_code, '') <> COALESCE(s.zip_code, ''))
        -- coalesce so if either is null, it recognizes it properly as a change
)
UPDATE users
SET is_current = FALSE,
    valid_to = now() AT TIME ZONE 'UTC'
WHERE user_id IN (SELECT user_id FROM change_table) AND is_current = TRUE;

-- inserts new version of changed users
INSERT INTO users (user_id, gender, age, occupation, zip_code, valid_from, valid_to, is_current)
SELECT s.user_id, s.gender, s.age::int, s.occupation, s.zip_code, now() AT TIME ZONE 'UTC', NULL, TRUE
FROM stg_users s
JOIN change_table c ON s.user_id = c.user_id;
]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-30 10:03:58,865 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 10:03:58,904 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 10:03:58,933 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 10:03:58,933 - __main__ - INFO - Creating tables if not exist..
2025-09-30 10:03:59,349 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 10:03:59,349 - __main__ - INFO - Processing users data..
2025-09-30 10:03:59,349 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 10:04:00,131 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 10:04:00,131 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 10:04:00,510 - pipeline.s_gold.load - INFO - User upsert complete. New and changed user records successfully processed.
2025-09-30 10:04:00,511 - pipeline.s_gold.silver_watermarks - INFO - Updating watermarks...
2025-09-30 10:04:00,511 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from MinIO..
2025-09-30 10:04:01,196 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: An error occurred (NoSuchKey) when calling the GetObject operation: The specified key does not exist.
2025-09-30 10:04:01,587 - pipeline.s_gold.silver_watermarks - ERROR - Failed to update watermarks: Parameter validation failed:
Unknown parameter in input: "content_type", must be one of: ACL, Body, Bucket, CacheControl, ContentDisposition, ContentEncoding, ContentLanguage, ContentLength, ContentMD5, ContentType, ChecksumAlgorithm, ChecksumCRC32, ChecksumCRC32C, ChecksumCRC64NVME, ChecksumSHA1, ChecksumSHA256, Expires, IfMatch, IfNoneMatch, GrantFullControl, GrantRead, GrantReadACP, GrantWriteACP, Key, WriteOffsetBytes, Metadata, ServerSideEncryption, StorageClass, WebsiteRedirectLocation, SSECustomerAlgorithm, SSECustomerKey, SSECustomerKeyMD5, SSEKMSKeyId, SSEKMSEncryptionContext, BucketKeyEnabled, RequestPayer, Tagging, ObjectLockMode, ObjectLockRetainUntilDate, ObjectLockLegalHoldStatus, ExpectedBucketOwner
2025-09-30 10:04:01,587 - __main__ - ERROR - Pipeline failed: Parameter validation failed:
Unknown parameter in input: "content_type", must be one of: ACL, Body, Bucket, CacheControl, ContentDisposition, ContentEncoding, ContentLanguage, ContentLength, ContentMD5, ContentType, ChecksumAlgorithm, ChecksumCRC32, ChecksumCRC32C, ChecksumCRC64NVME, ChecksumSHA1, ChecksumSHA256, Expires, IfMatch, IfNoneMatch, GrantFullControl, GrantRead, GrantReadACP, GrantWriteACP, Key, WriteOffsetBytes, Metadata, ServerSideEncryption, StorageClass, WebsiteRedirectLocation, SSECustomerAlgorithm, SSECustomerKey, SSECustomerKeyMD5, SSEKMSKeyId, SSEKMSEncryptionContext, BucketKeyEnabled, RequestPayer, Tagging, ObjectLockMode, ObjectLockRetainUntilDate, ObjectLockLegalHoldStatus, ExpectedBucketOwner
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 14, in silver_to_gold
    load_users_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 191, in load_users_df
    update_silver_watermarks(data)
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\silver_watermarks.py", line 73, in update_silver_watermarks
    client.put_object(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\botocore\client.py", line 602, in _api_call
    return self._make_api_call(operation_name, kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\botocore\context.py", line 123, in wrapper
    return func(*args, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\botocore\client.py", line 1035, in _make_api_call
    request_dict = self._convert_to_request_dict(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\botocore\client.py", line 1102, in _convert_to_request_dict
    request_dict = self._serializer.serialize_to_request(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\botocore\validate.py", line 381, in serialize_to_request
    raise ParamValidationError(report=report.generate_report())
botocore.exceptions.ParamValidationError: Parameter validation failed:
Unknown parameter in input: "content_type", must be one of: ACL, Body, Bucket, CacheControl, ContentDisposition, ContentEncoding, ContentLanguage, ContentLength, ContentMD5, ContentType, ChecksumAlgorithm, ChecksumCRC32, ChecksumCRC32C, ChecksumCRC64NVME, ChecksumSHA1, ChecksumSHA256, Expires, IfMatch, IfNoneMatch, GrantFullControl, GrantRead, GrantReadACP, GrantWriteACP, Key, WriteOffsetBytes, Metadata, ServerSideEncryption, StorageClass, WebsiteRedirectLocation, SSECustomerAlgorithm, SSECustomerKey, SSECustomerKeyMD5, SSEKMSKeyId, SSEKMSEncryptionContext, BucketKeyEnabled, RequestPayer, Tagging, ObjectLockMode, ObjectLockRetainUntilDate, ObjectLockLegalHoldStatus, ExpectedBucketOwner
2025-09-30 10:16:38,621 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 10:16:38,644 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 10:16:38,661 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 10:16:38,661 - __main__ - INFO - Creating tables if not exist..
2025-09-30 10:16:39,123 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 10:16:39,123 - __main__ - INFO - Processing users data..
2025-09-30 10:16:39,123 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 10:16:39,942 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 10:16:39,942 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 10:16:40,273 - pipeline.s_gold.load - INFO - User upsert complete. New and changed user records successfully processed.
2025-09-30 10:16:40,273 - pipeline.s_gold.silver_watermarks - INFO - Updating watermarks in S3...
2025-09-30 10:16:40,273 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:16:40,998 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: An error occurred (NoSuchKey) when calling the GetObject operation: The specified key does not exist.
2025-09-30 10:16:41,307 - pipeline.s_gold.silver_watermarks - INFO - Watermarks updated successfully in S3.
2025-09-30 10:16:41,307 - __main__ - INFO - Processing movies data..
2025-09-30 10:16:41,307 - pipeline.s_gold.read_bucket - INFO - Reading movies.csv from movie-pipeline-silver bucket.
2025-09-30 10:16:42,084 - pipeline.s_gold.read_bucket - INFO - Successfully read movies.csv into DataFrame. Shape: (1682, 5)
2025-09-30 10:16:42,084 - pipeline.s_gold.load - INFO - Starting incremental load for movie data..
2025-09-30 10:16:42,084 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:16:42,326 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:16:42,326 - pipeline.s_gold.load - WARNING - No watermark file found. Proceeding without filter.
2025-09-30 10:16:42,326 - pipeline.s_gold.load - INFO - Movie data cleaned and filtered with 1682 records.
2025-09-30 10:16:42,666 - pipeline.s_gold.load - ERROR - Upsert failed: (psycopg2.errors.SyntaxError) syntax error at or near "("
LINE 2: INSERT INTO (item_id, movie_title, release_date, primary_gen...
                    ^

[SQL: 
INSERT INTO (item_id, movie_title, release_date, primary_genre, imdb_url)
SELECT item_id, movie_title, release_date, primary_genre, imdb_url
FROM stg_movies
ON CONFLICT (item_id)
DO UPDATE SET 
    movie_title = EXCLUDED.movie_title,
    release_date = EXCLUDED.release_date,
    primary_genre = EXCLUDED.primary_genre,
    imdb_url = EXCLUDED.imdb_url;
]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.SyntaxError: syntax error at or near "("
LINE 2: INSERT INTO (item_id, movie_title, release_date, primary_gen...
                    ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 74, in load_movie_df
    conn.execute(text(upsert_movies))
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.SyntaxError) syntax error at or near "("
LINE 2: INSERT INTO (item_id, movie_title, release_date, primary_gen...
                    ^

[SQL: 
INSERT INTO (item_id, movie_title, release_date, primary_genre, imdb_url)
SELECT item_id, movie_title, release_date, primary_genre, imdb_url
FROM stg_movies
ON CONFLICT (item_id)
DO UPDATE SET 
    movie_title = EXCLUDED.movie_title,
    release_date = EXCLUDED.release_date,
    primary_genre = EXCLUDED.primary_genre,
    imdb_url = EXCLUDED.imdb_url;
]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-30 10:16:42,682 - __main__ - ERROR - Pipeline failed: (psycopg2.errors.SyntaxError) syntax error at or near "("
LINE 2: INSERT INTO (item_id, movie_title, release_date, primary_gen...
                    ^

[SQL: 
INSERT INTO (item_id, movie_title, release_date, primary_genre, imdb_url)
SELECT item_id, movie_title, release_date, primary_genre, imdb_url
FROM stg_movies
ON CONFLICT (item_id)
DO UPDATE SET 
    movie_title = EXCLUDED.movie_title,
    release_date = EXCLUDED.release_date,
    primary_genre = EXCLUDED.primary_genre,
    imdb_url = EXCLUDED.imdb_url;
]
(Background on this error at: https://sqlalche.me/e/20/f405)
Traceback (most recent call last):
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.SyntaxError: syntax error at or near "("
LINE 2: INSERT INTO (item_id, movie_title, release_date, primary_gen...
                    ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 17, in silver_to_gold
    load_movie_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 74, in load_movie_df
    conn.execute(text(upsert_movies))
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1412, in execute
    return meth(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1844, in _execute_context
    return self._exec_single_context(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\sqlalchemy\engine\default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.SyntaxError) syntax error at or near "("
LINE 2: INSERT INTO (item_id, movie_title, release_date, primary_gen...
                    ^

[SQL: 
INSERT INTO (item_id, movie_title, release_date, primary_genre, imdb_url)
SELECT item_id, movie_title, release_date, primary_genre, imdb_url
FROM stg_movies
ON CONFLICT (item_id)
DO UPDATE SET 
    movie_title = EXCLUDED.movie_title,
    release_date = EXCLUDED.release_date,
    primary_genre = EXCLUDED.primary_genre,
    imdb_url = EXCLUDED.imdb_url;
]
(Background on this error at: https://sqlalche.me/e/20/f405)
2025-09-30 10:20:37,614 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 10:20:37,658 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 10:20:37,682 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 10:20:37,682 - __main__ - INFO - Creating tables if not exist..
2025-09-30 10:20:38,114 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 10:20:38,114 - __main__ - INFO - Processing users data..
2025-09-30 10:20:38,114 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 10:20:38,944 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 10:20:38,945 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 10:20:39,254 - pipeline.s_gold.load - INFO - User upsert complete. New and changed user records successfully processed.
2025-09-30 10:20:39,254 - pipeline.s_gold.silver_watermarks - INFO - Updating watermarks in S3...
2025-09-30 10:20:39,254 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:20:39,972 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:20:40,719 - pipeline.s_gold.silver_watermarks - INFO - Watermarks updated successfully in S3.
2025-09-30 10:20:40,719 - __main__ - INFO - Processing movies data..
2025-09-30 10:20:40,719 - pipeline.s_gold.read_bucket - INFO - Reading movies.csv from movie-pipeline-silver bucket.
2025-09-30 10:20:41,568 - pipeline.s_gold.read_bucket - INFO - Successfully read movies.csv into DataFrame. Shape: (1682, 5)
2025-09-30 10:20:41,568 - pipeline.s_gold.load - INFO - Starting incremental load for movie data..
2025-09-30 10:20:41,569 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:20:41,813 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:20:41,814 - pipeline.s_gold.load - WARNING - No watermark file found. Proceeding without filter.
2025-09-30 10:20:41,815 - pipeline.s_gold.load - INFO - Movie data cleaned and filtered with 1682 records.
2025-09-30 10:20:42,111 - pipeline.s_gold.load - INFO - Upsert complete. New records successfully loaded
2025-09-30 10:20:42,113 - __main__ - ERROR - Pipeline failed: '>=' not supported between instances of 'str' and 'float'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 17, in silver_to_gold
    load_movie_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 85, in load_movie_df
    latest_max_value = df['release_date'].max()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\series.py", line 6189, in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 11962, in max
    return self._stat_function(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 11935, in _stat_function
    return self._reduce(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\series.py", line 6129, in _reduce
    return op(delegate, skipna=skipna, **kwds)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\nanops.py", line 147, in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\nanops.py", line 404, in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\nanops.py", line 1092, in reduction
    result = getattr(values, meth)(axis)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\numpy\core\_methods.py", line 41, in _amax
    return umr_maximum(a, axis, None, out, keepdims, initial, where)
TypeError: '>=' not supported between instances of 'str' and 'float'
2025-09-30 10:36:09,449 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 10:36:09,472 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 10:36:09,491 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 10:36:09,491 - __main__ - INFO - Creating tables if not exist..
2025-09-30 10:36:09,999 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 10:36:09,999 - __main__ - INFO - Processing users data..
2025-09-30 10:36:09,999 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 10:36:10,951 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 10:36:10,952 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 10:36:11,289 - pipeline.s_gold.load - INFO - User upsert complete. New and changed user records successfully processed.
2025-09-30 10:36:11,289 - pipeline.s_gold.silver_watermarks - INFO - Updating watermarks in S3...
2025-09-30 10:36:11,305 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:36:11,980 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:36:12,768 - pipeline.s_gold.silver_watermarks - INFO - Watermarks updated successfully in S3.
2025-09-30 10:36:12,768 - __main__ - INFO - Processing movies data..
2025-09-30 10:36:12,768 - pipeline.s_gold.read_bucket - INFO - Reading movies.csv from movie-pipeline-silver bucket.
2025-09-30 10:36:13,518 - pipeline.s_gold.read_bucket - INFO - Successfully read movies.csv into DataFrame. Shape: (1682, 5)
2025-09-30 10:36:13,518 - pipeline.s_gold.load - INFO - Starting incremental load for movie data..
2025-09-30 10:36:13,518 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:36:13,747 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:36:13,755 - pipeline.s_gold.load - WARNING - No watermark file found. Proceeding without filter.
2025-09-30 10:36:13,755 - pipeline.s_gold.load - INFO - Movie data cleaned and filtered with 1682 records.
2025-09-30 10:36:14,112 - pipeline.s_gold.load - INFO - Upsert complete. New records successfully loaded
2025-09-30 10:36:14,113 - __main__ - ERROR - Pipeline failed: '>=' not supported between instances of 'str' and 'float'
Traceback (most recent call last):
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\orchestration_S-G.py", line 17, in silver_to_gold
    load_movie_df()
  File "C:\Users\iyes\Desktop\Repositories\Ratings\pipeline\s_gold\load.py", line 85, in load_movie_df
    latest_max_value = df['release_date'].max()
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\series.py", line 6189, in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 11962, in max
    return self._stat_function(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\generic.py", line 11935, in _stat_function
    return self._reduce(
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\series.py", line 6129, in _reduce
    return op(delegate, skipna=skipna, **kwds)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\nanops.py", line 147, in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\nanops.py", line 404, in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\pandas\core\nanops.py", line 1092, in reduction
    result = getattr(values, meth)(axis)
  File "C:\Users\iyes\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.9_qbz5n2kfra8p0\LocalCache\local-packages\Python39\site-packages\numpy\core\_methods.py", line 41, in _amax
    return umr_maximum(a, axis, None, out, keepdims, initial, where)
TypeError: '>=' not supported between instances of 'str' and 'float'
2025-09-30 10:38:20,275 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 10:38:20,305 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 10:38:20,306 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 10:38:20,306 - __main__ - INFO - Creating tables if not exist..
2025-09-30 10:38:20,958 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 10:38:20,958 - __main__ - INFO - Processing users data..
2025-09-30 10:38:20,958 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 10:38:21,775 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 10:38:21,775 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 10:38:22,194 - pipeline.s_gold.load - INFO - User upsert complete. New and changed user records successfully processed.
2025-09-30 10:38:22,194 - pipeline.s_gold.silver_watermarks - INFO - Updating watermarks in S3...
2025-09-30 10:38:22,194 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:38:22,887 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:38:23,612 - pipeline.s_gold.silver_watermarks - INFO - Watermarks updated successfully in S3.
2025-09-30 10:38:23,612 - __main__ - INFO - Processing movies data..
2025-09-30 10:38:23,612 - pipeline.s_gold.read_bucket - INFO - Reading movies.csv from movie-pipeline-silver bucket.
2025-09-30 10:38:24,361 - pipeline.s_gold.read_bucket - INFO - Successfully read movies.csv into DataFrame. Shape: (1682, 5)
2025-09-30 10:38:24,385 - pipeline.s_gold.load - INFO - Starting incremental load for movie data..
2025-09-30 10:38:24,385 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:38:24,628 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:38:24,633 - pipeline.s_gold.load - WARNING - No watermark file found. Proceeding without filter.
2025-09-30 10:38:24,633 - pipeline.s_gold.load - INFO - Movie data cleaned and filtered with 1682 records.
2025-09-30 10:38:24,979 - pipeline.s_gold.load - INFO - Upsert complete. New records successfully loaded
2025-09-30 10:38:24,981 - pipeline.s_gold.silver_watermarks - INFO - Updating watermarks in S3...
2025-09-30 10:38:24,982 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:38:25,685 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:38:26,495 - pipeline.s_gold.silver_watermarks - INFO - Watermarks updated successfully in S3.
2025-09-30 10:38:26,511 - __main__ - INFO - Processing ratings data..
2025-09-30 10:38:26,511 - pipeline.s_gold.read_bucket - INFO - Reading ratings.csv from movie-pipeline-silver bucket.
2025-09-30 10:38:31,030 - pipeline.s_gold.read_bucket - INFO - Successfully read ratings.csv into DataFrame. Shape: (100000, 4)
2025-09-30 10:38:31,030 - pipeline.s_gold.load - INFO - Starting incremental load for ratings..
2025-09-30 10:38:31,030 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:38:31,287 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:38:31,290 - pipeline.s_gold.load - WARNING - No watermark file found. Proceeding without filter.
2025-09-30 10:38:31,291 - pipeline.s_gold.load - INFO - Ratings data cleaned and filtered with 100000 records.
2025-09-30 10:38:38,931 - pipeline.s_gold.load - INFO - Ratings upsert complete. New records successfully loaded.
2025-09-30 10:38:38,942 - pipeline.s_gold.silver_watermarks - INFO - Updating watermarks in S3...
2025-09-30 10:38:38,942 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:38:39,757 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:38:40,520 - pipeline.s_gold.silver_watermarks - INFO - Watermarks updated successfully in S3.
2025-09-30 10:38:40,520 - __main__ - INFO - All datasets processed successfully.
2025-09-30 10:43:14,626 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 10:43:14,636 - pipeline.s3_client - INFO - Successfully initialized S3 client.
2025-09-30 10:43:14,639 - __main__ - INFO - Starting silver-gold orchestration...
2025-09-30 10:43:14,639 - __main__ - INFO - Creating tables if not exist..
2025-09-30 10:43:15,251 - pipeline.s_gold.load - INFO - Tables exist.
2025-09-30 10:43:15,253 - __main__ - INFO - Processing users data..
2025-09-30 10:43:15,253 - pipeline.s_gold.read_bucket - INFO - Reading users.csv from movie-pipeline-silver bucket.
2025-09-30 10:43:16,298 - pipeline.s_gold.read_bucket - INFO - Successfully read users.csv into DataFrame. Shape: (943, 5)
2025-09-30 10:43:16,299 - pipeline.s_gold.load - INFO - Starting load for users..
2025-09-30 10:43:16,629 - pipeline.s_gold.load - INFO - User upsert complete. New and changed user records successfully processed.
2025-09-30 10:43:16,632 - pipeline.s_gold.silver_watermarks - INFO - Updating watermarks in S3...
2025-09-30 10:43:16,633 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:43:17,354 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:43:18,126 - pipeline.s_gold.silver_watermarks - INFO - Watermarks updated successfully in S3.
2025-09-30 10:43:18,126 - __main__ - INFO - Processing movies data..
2025-09-30 10:43:18,127 - pipeline.s_gold.read_bucket - INFO - Reading movies.csv from movie-pipeline-silver bucket.
2025-09-30 10:43:18,855 - pipeline.s_gold.read_bucket - INFO - Successfully read movies.csv into DataFrame. Shape: (1682, 5)
2025-09-30 10:43:18,863 - pipeline.s_gold.load - INFO - Starting incremental load for movie data..
2025-09-30 10:43:18,864 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:43:19,093 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:43:19,096 - pipeline.s_gold.load - WARNING - No watermark file found. Proceeding without filter.
2025-09-30 10:43:19,096 - pipeline.s_gold.load - INFO - Movie data cleaned and filtered with 1682 records.
2025-09-30 10:43:19,474 - pipeline.s_gold.load - INFO - Upsert complete. New records successfully loaded
2025-09-30 10:43:19,477 - pipeline.s_gold.silver_watermarks - INFO - Updating watermarks in S3...
2025-09-30 10:43:19,478 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:43:20,192 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:43:20,954 - pipeline.s_gold.silver_watermarks - INFO - Watermarks updated successfully in S3.
2025-09-30 10:43:20,954 - __main__ - INFO - Processing ratings data..
2025-09-30 10:43:20,955 - pipeline.s_gold.read_bucket - INFO - Reading ratings.csv from movie-pipeline-silver bucket.
2025-09-30 10:43:23,870 - pipeline.s_gold.read_bucket - INFO - Successfully read ratings.csv into DataFrame. Shape: (100000, 4)
2025-09-30 10:43:23,871 - pipeline.s_gold.load - INFO - Starting incremental load for ratings..
2025-09-30 10:43:23,871 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:43:24,101 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:43:24,102 - pipeline.s_gold.load - WARNING - No watermark file found. Proceeding without filter.
2025-09-30 10:43:24,103 - pipeline.s_gold.load - INFO - Ratings data cleaned and filtered with 100000 records.
2025-09-30 10:43:33,488 - pipeline.s_gold.load - INFO - Ratings upsert complete. New records successfully loaded.
2025-09-30 10:43:33,500 - pipeline.s_gold.silver_watermarks - INFO - Updating watermarks in S3...
2025-09-30 10:43:33,500 - pipeline.s_gold.silver_watermarks - INFO - Reading watermarks from s3..
2025-09-30 10:43:34,373 - pipeline.s_gold.silver_watermarks - WARNING - Watermarks not found. Initializing One. Details: 'body'
2025-09-30 10:43:35,204 - pipeline.s_gold.silver_watermarks - INFO - Watermarks updated successfully in S3.
2025-09-30 10:43:35,206 - __main__ - INFO - All datasets processed successfully.
